{"version":3,"sources":["../../app-src/controllers/TradingController.js"],"names":["Tradings","TradingsView","Message","MessageView","TradingService","InvalidDateException","Trading","Bind","DateConverter","TradingController","constructor","$","document","querySelector","bind","_inputDate","_inputAmount","_inputValue","_tradings","_message","_service","_init","add","event","preventDefault","trading","_createTrading","getTradingDao","then","dao","text","_clearForm","catch","err","message","removeAll","clear","importTradings","getAllTradings","tradings","filter","newTrading","toArray","some","existingTrading","equals","forEach","listAll","toDate","value","parseInt","parseFloat","focus"],"mappings":"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","file":"TradingController.js","sourcesContent":["import { Tradings } from '../domain/trading/Tradings.js';\nimport { TradingsView } from '../ui/views/TradingsView.js';\nimport { Message } from '../ui/models/Message.js';\nimport { MessageView } from '../ui/views/MessageView.js';\nimport { TradingService } from '../domain/trading/TradingService.js';\nimport { InvalidDateException } from '../ui/converters/InvalidDateException.js';\nimport { Trading } from '../domain/Trading/Trading.js';\nimport { Bind } from '../util/Bind.js';\nimport { DateConverter } from '../ui/converters/DateConverter.js';\n\nexport class TradingController {\n  constructor() {\n    const $ = document.querySelector.bind(document);\n\n    this._inputDate = $('#date');\n    this._inputAmount = $('#amount');\n    this._inputValue = $('#value');\n\n    this._tradings = new Bind(\n      new Tradings(),\n      new TradingsView('#tradings'),\n      'add', \n      'clear',\n    );\n\n    this._message = new Bind(\n      new Message(),\n      new MessageView('#message'),\n      'text',\n    );\n\n    this._service = new TradingService();\n    this._init();\n  }\n\n  add(event) {\n    try {\n      event.preventDefault();\n\n      const trading = this._createTrading();\n\n      getTradingDao()\n        .then(dao => dao.add(trading))\n        .then(() => {\n          this._tradings.add(trading);\n          this._message.text = 'Trading added successfully';\n          this._clearForm();\n        })\n        .catch(err => this._message.text = err);\n    } catch (err) {\n      if (err instanceof InvalidDateException) {\n        this._message.text = err.message;\n      } else {\n        this._message.text = 'An unexpected error occurred';\n      }\n    }\n  }\n\n  removeAll(event) {\n    getTradingDao()\n      .then(dao => dao.removeAll())\n      .then(() => {\n        this._tradings.clear();\n        this._message.text = 'Tradings removed successfully';\n      })\n      .catch(err => this._message.text = err);\n  }\n\n  importTradings() {\n    this._service.getAllTradings()\n      .then(tradings => {\n        tradings\n          .filter(newTrading => {\n            return !this._tradings.toArray().some((existingTrading) => {\n              return newTrading.equals(existingTrading);\n            })\n          })\n          .forEach(trading => this._tradings.add(trading));\n      })\n      .catch(err => this._message.text = err);\n  }\n\n  _init() {\n    getTradingDao()\n      .then(dao => dao.listAll())\n      .then(tradings =>\n        tradings.forEach(trading =>\n          this._tradings.add(trading)))\n      .catch(err => this._message.text = err);\n  }\n\n  _createTrading() {\n    return new Trading(\n      DateConverter.toDate(this._inputDate.value),\n      parseInt(this._inputAmount.value),\n      parseFloat(this._inputValue.value),\n    );\n  }\n\n  _clearForm() {\n    this._inputDate.value = '';\n    this._inputAmount.value = 1;\n    this._inputValue.value = 0.0;\n    this._inputDate.focus();\n  }\n}\n"]}